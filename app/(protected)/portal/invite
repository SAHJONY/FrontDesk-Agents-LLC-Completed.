'use client';

import { useState } from 'react';
import { createClient } from '@/utils/supabase/client';
import { Link, Copy, Check, ShieldCheck, Zap, UserPlus } from 'lucide-react';

export default function InviteManager() {
  const supabase = createClient();
  const [clientName, setClientName] = useState('');
  const [generatedLink, setGeneratedLink] = useState('');
  const [copied, setCopied] = useState(false);

  const createInvite = async () => {
    const { data, error } = await supabase
      .from('client_invitations')
      .insert([{ client_name: clientName }])
      .select()
      .single();

    if (data) {
      // Constructs a link like: yourdomain.com/portal/login?key=abc123...
      const link = `${window.location.origin}/portal/login?key=${data.access_key}`;
      setGeneratedLink(link);
    }
  };

  const copyToClipboard = () => {
    navigator.clipboard.writeText(generatedLink);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <div className="max-w-2xl mx-auto mt-20 p-10 bg-[#000d1a] border border-cyan-500/20 rounded-[40px] shadow-2xl">
      <div className="flex items-center gap-3 mb-8">
        <div className="p-3 bg-cyan-500/10 rounded-2xl">
          <UserPlus className="w-6 h-6 text-cyan-500" />
        </div>
        <h2 className="text-2xl font-black text-white uppercase italic italic tracking-tighter">Client <span className="text-cyan-500">Access Generator</span></h2>
      </div>

      <div className="space-y-6">
        <div>
          <label className="text-[10px] font-black uppercase tracking-widest text-slate-500 ml-2">Client Identity</label>
          <input 
            type="text" 
            placeholder="e.g. Acme Corp Real Estate"
            className="w-full bg-black/40 border border-white/5 rounded-2xl p-4 mt-2 text-white outline-none focus:border-cyan-500/30 transition-all"
            value={clientName}
            onChange={(e) => setClientName(e.target.value)}
          />
        </div>

        <button 
          onClick={createInvite}
          className="w-full py-5 bg-cyan-500 text-[#000814] rounded-2xl font-black text-[11px] uppercase tracking-[0.2em] shadow-lg shadow-cyan-500/20 hover:scale-[1.02] transition-all"
        >
          Generate Secure Access Link
        </button>

        {generatedLink && (
          <div className="mt-8 p-6 bg-black/60 rounded-3xl border border-cyan-500/20 animate-in zoom-in-95">
            <p className="text-[9px] font-black uppercase text-cyan-500 mb-3 tracking-widest">Active Magic Link</p>
            <div className="flex items-center gap-4">
              <input 
                readOnly 
                value={generatedLink} 
                className="flex-1 bg-transparent text-xs text-slate-400 font-mono truncate"
              />
              <button 
                onClick={copyToClipboard}
                className="p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all"
              >
                {copied ? <Check className="w-4 h-4 text-emerald-500" /> : <Copy className="w-4 h-4 text-slate-400" />}
              </button>
            </div>
            <div className="mt-4 flex items-center gap-2 text-[8px] text-slate-600 font-bold uppercase tracking-widest">
              <ShieldCheck className="w-3 h-3" /> Link expires in 30 days
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

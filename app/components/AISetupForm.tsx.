// app/components/AISetupForm.tsx
'use client';

import { useState, FormEvent } from 'react';
import { supabase } from '@/lib/supabaseClient';
import Image from 'next/image';

export default function AISetupForm() {
  const [lang, setLang] = useState<'en' | 'es'>('en');
  const content = {
    en: {
      title: 'Set Up Your AI Receptionist',
      subtitle: 'Configure an AI-powered receptionist for your online business.',
      fields: {
        business: 'Business Name',
        website: 'Website',
        receptionist: 'Receptionist Name',
        purpose: 'Main Purpose',
      },
      button: 'Continue',
      imageAlt: 'AI Receptionist Configuration Screen',
    },
    es: {
      title: 'Configura Tu Recepcionista de IA',
      subtitle:
        'Configura una recepcionista impulsada por IA para tu negocio en línea.',
      fields: {
        business: 'Nombre del Negocio',
        website: 'Sitio Web',
        receptionist: 'Nombre de la Recepcionista',
        purpose: 'Propósito Principal',
      },
      button: 'Continuar',
      imageAlt: 'Pantalla de Configuración de Recepcionista IA',
    },
  };
  const t = content[lang];
  const [formData, setFormData] = useState({
    business_name: '',
    website: '',
    receptionist_name: '',
    purpose: '',
  });
  const [loading, setLoading] = useState(false);
  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setMessage(null);

    const payload = {
      ...formData,
      language: lang, // Add the current language to the payload
    };

    const { data, error } = await supabase
      .from('receptionist_configs')
      .insert([payload]);

    if (error) {
      console.error('Supabase Insert Error:', error);
      setMessage({ type: 'error', text: \`Error saving configuration: \${error.message}\` });
    } else {
      setMessage({ type: 'success', text: 'Configuration saved successfully! Thank you.' });
      // Optionally clear form data
      setFormData({
        business_name: '',
        website: '',
        receptionist_name: '',
        purpose: '',
      });
    }

    setLoading(false);
  };

  return (
    <section className="bg-[#0A0A12] text-white py-20 px-6 flex flex-col items-center">
      {/* Language Toggle */}
      <div className="w-full max-w-4xl flex justify-end mb-4 space-x-3 text-sm font-semibold">
        <button
          className={`${lang === 'en' ? 'text-cyan-400' : 'text-gray-400'}`}
          onClick={() => setLang('en')}
        >
          EN
        </button>
        <button
          className={`${lang === 'es' ? 'text-cyan-400' : 'text-gray-400'}`}
          onClick={() => setLang('es')}
        >
          ES
        </button>
      </div>

      {/* Preview Image */}
      <div className="w-full max-w-4xl overflow-hidden rounded-2xl mb-10">
        <Image
          src="/ai_receptionist_dashboard.jpg" // replace with your actual dashboard image
          alt={t.imageAlt}
          width={1200}
          height={600}
          className="w-full object-cover"
          priority
        />
      </div>

      {/* Setup Form */}
	      <div className="w-full max-w-2xl bg-[#111827] p-10 rounded-2xl shadow-lg">
        {message && (
          <div
            className={\`p-4 mb-4 rounded-lg text-sm font-medium \${
              message.type === 'success'
                ? 'bg-green-500 text-white'
                : 'bg-red-500 text-white'
            }\`}
          >
            {message.text}
          </div>
        )}
        <h2 className="text-2xl md:text-3xl font-bold mb-2">{t.title}</h2>
        <p className="text-gray-400 mb-8">{t.subtitle}</p>

	        <form className="space-y-4" onSubmit={handleSubmit}>
	          <input
	            type="text"
	            name="business_name"
	            value={formData.business_name}
	            onChange={handleChange}
	            placeholder={t.fields.business}
	            required
	            className="w-full bg-[#1F2937] text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400"
	          />
	          <input
	            type="text"
	            name="website"
	            value={formData.website}
	            onChange={handleChange}
	            placeholder={t.fields.website}
	            required
	            className="w-full bg-[#1F2937] text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400"
	          />
	          <input
	            type="text"
	            name="receptionist_name"
	            value={formData.receptionist_name}
	            onChange={handleChange}
	            placeholder={t.fields.receptionist}
	            required
	            className="w-full bg-[#1F2937] text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400"
	          />
	          <input
	            type="text"
	            name="purpose"
	            value={formData.purpose}
	            onChange={handleChange}
	            placeholder={t.fields.purpose}
	            required
	            className="w-full bg-[#1F2937] text-white px-4 py-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-400"
	          />
          <button
	            type="submit"
	            disabled={loading}
	            className={\`w-full text-black font-semibold py-3 rounded-full transition \${
	              loading
	                ? 'bg-gray-500 cursor-not-allowed'
	                : 'bg-cyan-400 hover:bg-cyan-300'
	            }\`}
	          >
	            {loading ? 'Saving...' : t.button}
          </button>
        </form>
      </div>
    </section>
  );
}
